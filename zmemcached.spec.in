%define bin_name memcached

Name:           zmemcached
Version:        @VERSION@
Release:        @RELEASE@%{?dist}
Summary:        High Performance, Distributed Memory Object Cache

Group:          System Environment/Daemons
License:        BSD
URL:            http://www.danga.com/memcached/
#Source0:        http://memcached.googlecode.com/files/%{name}-@FULLVERSION@.tar.gz
BuildRoot:      %{_topdir}/BUILD

Requires: initscripts
Requires(post): /sbin/chkconfig
Requires(preun): /sbin/chkconfig, /sbin/service
Requires(postun): /sbin/service
Conflicts: memcached

%description
memcached is a high-performance, distributed memory object caching
system, generic in nature, but intended for use in speeding up dynamic
web applications by alleviating database load.

%prep
#%setup -q -n %{name}-@FULLVERSION@

%build

%install

# Default configs
mkdir -p %{buildroot}/%{_sysconfdir}/sysconfig
cat <<EOF >%{buildroot}/%{_sysconfdir}/sysconfig/%{bin_name}
PORT="11211"
USER="nobody"
MAXCONN="1024"
OPTIONS="-E /usr/local/lib/ep.so"
EOF

# pid directory
mkdir -p %{buildroot}/%{_localstatedir}/run/memcached

%clean

%post
/sbin/chkconfig --add %{bin_name}

%preun
if [ "$1" = 0 ] ; then
    /sbin/service %{bin_name} stop > /dev/null 2>&1
    /sbin/chkconfig --del %{bin_name}
fi
exit 0

%postun
if [ "$1" -ge 1 ]; then
    /sbin/service %{bin_name} condrestart > /dev/null 2>&1
fi
exit 0


%files
%defattr(-,root,root,-)
#%doc AUTHORS ChangeLog COPYING NEWS README doc/CONTRIBUTORS doc/*.txt
%doc
%config(noreplace) %{_sysconfdir}/sysconfig/%{bin_name}

%dir %attr(750,nobody,nobody) %{_localstatedir}/run/memcached
%{_initrddir}/memcached
/usr/local/bin/memcached-tool
/usr/local/bin/memcached
/usr/local/man/man1/memcached.1*
/usr/local/include/memcached
/usr/local/lib/*
/usr/local/memcached/*

%changelog
* Wed Feb  3 2010 Jayesh Jose <jjose@zynga.com>  - 0.0.1
- Initial spec file created 
